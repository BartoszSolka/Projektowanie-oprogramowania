<!DOCTYPE html>
<html lang="en">
<head>
    <title>Interfejs usługodawcy</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<nav class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand">System Administratora</a>
        </div>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="/logout">Wyloguj</a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <div class="jumbotron">
        <h2>Edytuj usługodawce</h2>
        <br><br>
        <div id="provider"></div>

        <script>
            var index = getUrlVars()["id"];
            function getUrlVars() {
                var vars = {};
                var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                    vars[key] = value;
                });
                return vars;
            }
            $.get('http://localhost:8080/admin/provider/'+index, function (data) {
                console.log(data);
                var div = document.getElementById("provider");
                    var input0 = document.createElement("input");
                    var att0 = document.createAttribute("id");
                    var btt0 = document.createAttribute("style");
                    att0.value = "name";
                    btt0.value = "width: 70%;";
                    input0.setAttributeNode(att0);
                    input0.setAttributeNode(btt0);
                    var input1 = document.createElement("input");
                var att1 = document.createAttribute("id");
                var btt1 = document.createAttribute("style");
                btt1.value = "width: 70%;";
                att1.value = "nip";
                    input1.setAttributeNode(att1);
                    input1.setAttributeNode(btt1);
                    var input2 = document.createElement("input");
                var att2 = document.createAttribute("id");
                var btt2 = document.createAttribute("style");
                btt2.value = "width: 70%;";
                    att2.value = "phoneNumber";
                    input2.setAttributeNode(att2);
                    input2.setAttributeNode(btt2);
                    var input3 = document.createElement("input");
                var att3 = document.createAttribute("id");
                var btt3 = document.createAttribute("style");
                btt3.value = "width: 70%;";
                    att3.value = "address";
                    input3.setAttributeNode(att3);
                    input3.setAttributeNode(btt3);
                    var input4 = document.createElement("input");
                var att4 = document.createAttribute("id");
                var btt4 = document.createAttribute("style");
                btt4.value = "width: 70%;";
                    att4.value = "email";
                    input4.setAttributeNode(att4);
                    input4.setAttributeNode(btt4);
                    var input5 = document.createElement("input");
                var att5 = document.createAttribute("id");
                var btt5 = document.createAttribute("style");
                btt5.value = "width: 70%;";
                    att5.value = "zone";
                    input5.setAttributeNode(att5);
                    input5.setAttributeNode(btt5);



                input0.value = data.name;
                input1.value = data.nip;
                input2.value = data.phoneNo;
                input3.value = data.address;
                input4.value = data.email;
                input5.value = data.zone.postalCode;

                    s = document.createElement("h4");
                s1 = document.createElement("h4");
                s2 = document.createElement("h4");
                s3 = document.createElement("h4");
                s4 = document.createElement("h4");
                s5 = document.createElement("h4");


                    text1= document.createTextNode('Nazwa:' );
                text2= document.createTextNode('Nip:' );
                text3= document.createTextNode('Telefon:' );
                text4= document.createTextNode('Adres:' );
                text5= document.createTextNode('Email:' );
                text6= document.createTextNode('Strefa:' );




                    s.appendChild(text1);
                    div.appendChild(s);
                    div.appendChild(input0);


                s1.appendChild(text2);
                div.appendChild(s1);
                div.appendChild(input1);
                s2.appendChild(text3);
                div.appendChild(s2);
                div.appendChild(input2);
                s3.appendChild(text4);
                div.appendChild(s3);
                div.appendChild(input3);
                s4.appendChild(text5);
                div.appendChild(s4);
                div.appendChild(input4);
                s5.appendChild(text6);
                div.appendChild(s5);
                div.appendChild(input5);



            })
        </script>

        <button type="button" class="btn btn-success" onclick="edytujUslugodawce();">Edytuj</button>

        <div class="modal fade" id="successModal" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Dodanie usługodawcy</h4>
                    </div>
                    <div class="modal-body">
                        <p>Operacja zakończona pomyślnie.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="failModalNIP" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Błąd !</h4>
                    </div>
                    <div class="modal-body">
                        <p>Operacja zakończona niepowodzeniem. Sprawdź poprawność danych. Nip powinien sie skałać z 10 cyfr</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="failModalPostalCode" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Błąd !</h4>
                    </div>
                    <div class="modal-body">
                        <p>Operacja zakończona niepowodzeniem. Sprawdź poprawność danych. Kod pocztowy powinien mieć foramt 00-000.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="failModalEmail" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Błąd !</h4>
                    </div>
                    <div class="modal-body">
                        <p>Operacja zakończona niepowodzeniem. Sprawdź poprawność danych. Email powinien mieć foramt przykład@domena.pl.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="failModalTelefon" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Błąd !</h4>
                    </div>
                    <div class="modal-body">
                        <p>Operacja zakończona niepowodzeniem. Sprawdź poprawność danych. Telefon powinien mieć foramt +48123123123.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="failModal" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Błąd !</h4>
                    </div>
                    <div class="modal-body">
                        <p>Operacja zakończona niepowodzeniem. Sprawdź poprawność danych.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="failModalNoCode" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Błąd !</h4>
                    </div>
                    <div class="modal-body">
                        <p>Operacja zakończona niepowodzeniem. Uzupelnij wszystkie pola.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<script>
var edytujUslugodawce = function () {
    var name = document.getElementById('name').value;
    var nip = document.getElementById('nip').value;
    var phoneNumber = document.getElementById('phoneNumber').value;
    var address = document.getElementById('address').value;
    var zone = document.getElementById("zone").value;
    var email = document.getElementById("email").value;
    var index = getUrlVars()["id"];
    function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
            vars[key] = value;
        });
        return vars;
    }
    function validForm(inputDOMElement) {
        if (!inputDOMElement) {
            $("#failModalNoCode").modal();
            return false
        } else {
            return true
        }
    }

    function validPostalCode(inputDOMElement) {
        var codeReg = /[0-9]{2}[-][0-9]{3}/g;
        if (codeReg.test(inputDOMElement)) {

            return true
        } else {
            console.log(codeReg);
            console.log(inputDOMElement);

            $("#failModalPostalCode").modal();
            return false
        }
    }
    function validNIPCode(inputDOMElement) {
        var codeReg = /[0-9]{10}/g;
        if (codeReg.test(inputDOMElement)) {
            return true
        } else {
            console.log(codeReg);
            console.log(inputDOMElement);
            $("#failModalNIP").modal();
            return false
        }
    }
    function validEmailCode(inputDOMElement) {
        var codeReg = /^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
        if (codeReg.test(inputDOMElement)) {
            return true
        } else {
            console.log(codeReg);
            console.log(inputDOMElement);
            $("#failModalEmail").modal();
            return false
        }
    }
    function validTelephone(inputDOMElement) {
        var codeReg = /[+][0-9]{11}/g;
        if (codeReg.test(inputDOMElement)) {
            return true
        } else {
            console.log(codeReg);
            console.log(inputDOMElement);
            $("#failModalTelefon").modal();
            return false
        }
    }
    validPostalCode(zone) ;
    validTelephone(phoneNumber) ;
    validNIPCode(nip);
    validForm(address);
    validForm(name);
    validEmailCode(email)
    var isValid =
        validPostalCode(zone) &&
        validTelephone(phoneNumber) &&
        validNIPCode(nip)&&
        validForm(address)&&
    validForm(name)&&
        validEmailCode(email)
    if (isValid) {
$.ajax({
type: 'POST',
url: 'http://localhost:8080/admin/editProvider/'+index,
data: {
nip : nip,
telefon : phoneNumber,
siedzibaFirmy : address,
nazwa : name,
    kodStrefy : zone,
email : email
},
success: function (response) {
console.log(response);
$("#successModal").modal();
},
error: function (response) {
console.log(response);
$("#failModal").modal();
}
});

}}

</script>
</body>
</html>